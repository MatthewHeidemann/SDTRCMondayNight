
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monday Night Doubles</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
  const ADMIN_PASSWORD = "tennis123";

  function login() {
    const input = document.getElementById("admin-password").value;
    if (input === ADMIN_PASSWORD) {
      localStorage.setItem("admin-auth", "true");
      unlockAdminUI();
    } else {
      alert("Incorrect password.");
    }
  }

  function unlockAdminUI() {
    document.getElementById("admin-subnav").style.display = "block";
    document.getElementById("login-section").style.display = "none";
  }

  function checkAuth() {
    if (localStorage.getItem("admin-auth") === "true") {
      unlockAdminUI();
    } else {
      document.getElementById("admin-subnav").style.display = "none";
    }
  }


  let allPlayers = [];
  let mainGroup = [];
  let walkOns = [[], [], []];

  function lockWeek() {
    const weekKey = getMondayDate();
    db.ref("state/" + weekKey).update({ locked: true }).then(() => {
      document.getElementById("lock-confirm").innerText = "Submissions locked for the week.";
      checkLockState();
    });
  }

  function loadWeeklyAdminPlayers() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      allPlayers = Object.entries(data)
        .filter(([_, val]) => val.status === "Yes")
        .sort((a, b) => a[1].timestamp - b[1].timestamp)
        .map(([name]) => name);

      mainGroup = [...allPlayers];
      walkOns = [[], [], []];
      renderGroups();
    });
  }

  function renderGroups() {
    document.getElementById("main-play").innerHTML = mainGroup.map((name, i) =>
      `<div>${name}
        <button onclick="moveToWalkOn(${i}, 0)">‚Üí Walk-On 1</button>
        <button onclick="moveToWalkOn(${i}, 1)">‚Üí Walk-On 2</button>
        <button onclick="moveToWalkOn(${i}, 2)">‚Üí Walk-On 3</button>
      </div>`).join("");

    walkOns.forEach((group, index) => {
      document.getElementById("walkon" + (index + 1)).innerHTML = group.map((name, i) =>
        `<div>${name} <button onclick="moveToMain(${index}, ${i})">‚Üê Back</button></div>`).join("");
    });
  }

  function moveToWalkOn(index, groupIndex) {
    const player = mainGroup.splice(index, 1)[0];
    walkOns[groupIndex].push(player);
    renderGroups();
  }

  function moveToMain(groupIndex, playerIndex) {
    const player = walkOns[groupIndex].splice(playerIndex, 1)[0];
    mainGroup.push(player);
    renderGroups();
  }

</script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js">
  const ADMIN_PASSWORD = "tennis123";

  function login() {
    const input = document.getElementById("admin-password").value;
    if (input === ADMIN_PASSWORD) {
      localStorage.setItem("admin-auth", "true");
      unlockAdminUI();
    } else {
      alert("Incorrect password.");
    }
  }

  function unlockAdminUI() {
    document.getElementById("admin-subnav").style.display = "block";
    document.getElementById("login-section").style.display = "none";
  }

  function checkAuth() {
    if (localStorage.getItem("admin-auth") === "true") {
      unlockAdminUI();
    } else {
      document.getElementById("admin-subnav").style.display = "none";
    }
  }


  let allPlayers = [];
  let mainGroup = [];
  let walkOns = [[], [], []];

  function lockWeek() {
    const weekKey = getMondayDate();
    db.ref("state/" + weekKey).update({ locked: true }).then(() => {
      document.getElementById("lock-confirm").innerText = "Submissions locked for the week.";
      checkLockState();
    });
  }

  function loadWeeklyAdminPlayers() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      allPlayers = Object.entries(data)
        .filter(([_, val]) => val.status === "Yes")
        .sort((a, b) => a[1].timestamp - b[1].timestamp)
        .map(([name]) => name);

      mainGroup = [...allPlayers];
      walkOns = [[], [], []];
      renderGroups();
    });
  }

  function renderGroups() {
    document.getElementById("main-play").innerHTML = mainGroup.map((name, i) =>
      `<div>${name}
        <button onclick="moveToWalkOn(${i}, 0)">‚Üí Walk-On 1</button>
        <button onclick="moveToWalkOn(${i}, 1)">‚Üí Walk-On 2</button>
        <button onclick="moveToWalkOn(${i}, 2)">‚Üí Walk-On 3</button>
      </div>`).join("");

    walkOns.forEach((group, index) => {
      document.getElementById("walkon" + (index + 1)).innerHTML = group.map((name, i) =>
        `<div>${name} <button onclick="moveToMain(${index}, ${i})">‚Üê Back</button></div>`).join("");
    });
  }

  function moveToWalkOn(index, groupIndex) {
    const player = mainGroup.splice(index, 1)[0];
    walkOns[groupIndex].push(player);
    renderGroups();
  }

  function moveToMain(groupIndex, playerIndex) {
    const player = walkOns[groupIndex].splice(playerIndex, 1)[0];
    mainGroup.push(player);
    renderGroups();
  }

</script>
  <script src="./firebase.js">
  const ADMIN_PASSWORD = "tennis123";

  function login() {
    const input = document.getElementById("admin-password").value;
    if (input === ADMIN_PASSWORD) {
      localStorage.setItem("admin-auth", "true");
      unlockAdminUI();
    } else {
      alert("Incorrect password.");
    }
  }

  function unlockAdminUI() {
    document.getElementById("admin-subnav").style.display = "block";
    document.getElementById("login-section").style.display = "none";
  }

  function checkAuth() {
    if (localStorage.getItem("admin-auth") === "true") {
      unlockAdminUI();
    } else {
      document.getElementById("admin-subnav").style.display = "none";
    }
  }


  let allPlayers = [];
  let mainGroup = [];
  let walkOns = [[], [], []];

  function lockWeek() {
    const weekKey = getMondayDate();
    db.ref("state/" + weekKey).update({ locked: true }).then(() => {
      document.getElementById("lock-confirm").innerText = "Submissions locked for the week.";
      checkLockState();
    });
  }

  function loadWeeklyAdminPlayers() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      allPlayers = Object.entries(data)
        .filter(([_, val]) => val.status === "Yes")
        .sort((a, b) => a[1].timestamp - b[1].timestamp)
        .map(([name]) => name);

      mainGroup = [...allPlayers];
      walkOns = [[], [], []];
      renderGroups();
    });
  }

  function renderGroups() {
    document.getElementById("main-play").innerHTML = mainGroup.map((name, i) =>
      `<div>${name}
        <button onclick="moveToWalkOn(${i}, 0)">‚Üí Walk-On 1</button>
        <button onclick="moveToWalkOn(${i}, 1)">‚Üí Walk-On 2</button>
        <button onclick="moveToWalkOn(${i}, 2)">‚Üí Walk-On 3</button>
      </div>`).join("");

    walkOns.forEach((group, index) => {
      document.getElementById("walkon" + (index + 1)).innerHTML = group.map((name, i) =>
        `<div>${name} <button onclick="moveToMain(${index}, ${i})">‚Üê Back</button></div>`).join("");
    });
  }

  function moveToWalkOn(index, groupIndex) {
    const player = mainGroup.splice(index, 1)[0];
    walkOns[groupIndex].push(player);
    renderGroups();
  }

  function moveToMain(groupIndex, playerIndex) {
    const player = walkOns[groupIndex].splice(playerIndex, 1)[0];
    mainGroup.push(player);
    renderGroups();
  }

</script>
  <style>
    body { font-family: Arial, sans-serif; margin: auto; max-width: 900px; padding: 20px; }
    nav a, .admin-nav a { margin: 0 10px; cursor: pointer; font-weight: bold; display: inline-block; }
    .view { display: none; margin-top: 30px; }
    .active { display: block; }
    .section-title { font-weight: bold; margin-top: 20px; }
    .player { padding-left: 20px; }
    .admin-nav { margin-top: 10px; display: none; }
  </style>
</head>
<body>

<h1>üéæ Monday Night Doubles</h1>

<nav id="main-nav">
  <a id="main-tab" onclick="showView(currentMainTab)">Loading...</a>
  <a onclick="showAdminNav()">Admin ‚ñæ</a>

<span id="login-section" style="float:right;">
  <input type="password" id="admin-password" placeholder="Admin Password">
  <button onclick="login()">Login</button>
</span>

</nav>

<div class="admin-nav" id="admin-subnav">
  <a onclick="showView('weeklyAdmin')">Weekly Admin</a>
  <a onclick="showView('admin')">Application Admin</a>
</div>

<!-- RSVP View -->
<div id="rsvp" class="view">
  <h2>RSVP for Next Monday</h2>
  <div>
    <label for="player-name">Select your name:</label>
    <select id="player-name">
      <option value="">-- Choose your name --</option>
    </select><br><br>
    <label><input type="radio" name="status" value="Yes"> Yes, I'm in</label><br>
    <label><input type="radio" name="status" value="No"> No, not this week</label><br>
    <button onclick="submitResponse()">Submit / Update</button>
  </div>
  <div class="section-title">In:</div>
  <div id="in-list"></div>
  <div class="section-title">Pending:</div>
  <div id="pending-list"></div>
  <div class="section-title">Out:</div>
  <div id="out-list"></div>
</div>

<!-- Admin View -->
<div id="admin" class="view">
  <h2>Application Admin</h2>
  <div>
    <input type="text" id="new-player-name" placeholder="Enter player name">
    <button onclick="addPlayer()">Add Player</button>
  </div>
  <div class="section-title">Current Players:</div>
  <div id="player-list"></div>
  <div class="section-title">Reset Weekly Responses:</div>
  <button onclick="resetResponses()">Reset This Week</button>
  <div id="reset-status"></div>
</div>

<!-- Weekly Admin View -->
<div id="weeklyAdmin" class="view">
<h2>Weekly Admin</h2>
<button onclick="lockWeek()">Lock Submissions for the Week</button>
<div id="lock-confirm" style="margin: 10px 0; color: green;"></div>

<h3>Main Play Group</h3>
<input type="text" id="main-label" placeholder="e.g. Courts 1‚Äì4"><br>
<div id="main-play" class="group-box"></div>

<h3>Walk-On Courts</h3>
<div>
  <input type="text" id="walkon1-label" placeholder="Walk-On Court 1 Label"><br>
  <div id="walkon1" class="group-box"></div>
  <input type="text" id="walkon2-label" placeholder="Walk-On Court 2 Label"><br>
  <div id="walkon2" class="group-box"></div>
  <input type="text" id="walkon3-label" placeholder="Walk-On Court 3 Label"><br>
  <div id="walkon3" class="group-box"></div>
</div>

  <h2>Weekly Admin (coming soon)</h2>
  <p>This section will allow you to lock RSVPs and assign players to courts.</p>
</div>

<!-- Results View -->
<div id="results" class="view">
  <h2>Final Results</h2>
  <p>This section will show finalized player groupings and court assignments.</p>
</div>

<script>
  const db = firebase.database();
  let currentMainTab = "rsvp";

  function showView(id) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function showAdminNav() {
    document.getElementById("admin-subnav").style.display = "block";
    showView("weeklyAdmin");
  }

  function getMondayDate() {
    const today = new Date();
    const nextMonday = new Date(today.setDate(today.getDate() + ((1 + 7 - today.getDay()) % 7 || 7)));
    return nextMonday.toISOString().split('T')[0];
  }

  function submitResponse() {
    const name = document.getElementById("player-name").value;
    const statusInput = document.querySelector('input[name="status"]:checked');
    if (!name || !statusInput) {
      alert("Please select both name and status.");
      return;
    }
    const status = statusInput.value;
    const timestamp = Date.now();
    const weekKey = getMondayDate();

    db.ref("responses/" + weekKey + "/" + name).set({
      name: name,
      status: status,
      timestamp: timestamp
    });
  }

  function loadResponses() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).on("value", (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const inList = [];
      const pendingList = [];
      const outList = [];

      const yesResponses = [];
      for (const name in data) {
        if (data[name].status === "Yes") {
          yesResponses.push({ name: name, timestamp: data[name].timestamp });
        } else {
          outList.push(name);
        }
      }

      yesResponses.sort((a, b) => a.timestamp - b.timestamp);
      yesResponses.forEach((entry, index) => {
        if ((index + 1) % 4 === 0) {
          inList.push(entry.name);
        } else {
          pendingList.push(entry.name);
        }
      });

      document.getElementById("in-list").innerHTML = inList.map(n => `<div class="player">${n}</div>`).join("");
      document.getElementById("pending-list").innerHTML = pendingList.map(n => `<div class="player">${n}</div>`).join("");
      document.getElementById("out-list").innerHTML = outList.map(n => `<div class="player">${n}</div>`).join("");
    });
  }

  function loadPlayers() {
    db.ref("users").once("value").then(snapshot => {
      const players = snapshot.val();
      const dropdown = document.getElementById("player-name");
      dropdown.innerHTML = '<option value="">-- Choose your name --</option>';
      if (!players) return;
      const sortedKeys = Object.keys(players).sort((a, b) => players[a].localeCompare(players[b]));
      for (const key of sortedKeys) {
        const opt = document.createElement("option");
        opt.value = players[key];
        opt.text = players[key];
        dropdown.appendChild(opt);
      }
    });
  }

  function loadPlayerList() {
    db.ref("users").once("value").then(snapshot => {
      const players = snapshot.val();
      const listDiv = document.getElementById("player-list");
      listDiv.innerHTML = "";
      if (!players) return;
      Object.entries(players).sort((a, b) => a[1].localeCompare(b[1])).forEach(([key, name]) => {
        const div = document.createElement("div");
        div.innerHTML = `${name} <button onclick="removePlayer('${key}')">Remove</button>`;
        listDiv.appendChild(div);
      });
    });
  }

  function addPlayer() {
    const name = document.getElementById("new-player-name").value.trim();
    if (!name) return alert("Enter a valid name");
    db.ref("users").push(name).then(() => {
      document.getElementById("new-player-name").value = "";
      loadPlayers();
      loadPlayerList();
    });
  }

  function removePlayer(key) {
    db.ref("users/" + key).remove().then(() => {
      loadPlayers();
      loadPlayerList();
    });
  }

  function resetResponses() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).remove().then(() => {
      document.getElementById("reset-status").innerText = "This week's responses have been cleared.";
      loadResponses();
    });
  }

  function checkLockState() {
    const weekKey = getMondayDate();
    db.ref("state/" + weekKey + "/locked").once("value").then(snapshot => {
      const locked = snapshot.val() === true;
      currentMainTab = locked ? "results" : "rsvp";
      document.getElementById("main-tab").innerText = locked ? "Results" : "RSVP";
      showView(currentMainTab);
    });
  }

  // Initialize
  loadPlayers();
  loadResponses();
  loadPlayerList();
  checkLockState();
  loadWeeklyAdminPlayers();
  checkAuth();

  const ADMIN_PASSWORD = "tennis123";

  function login() {
    const input = document.getElementById("admin-password").value;
    if (input === ADMIN_PASSWORD) {
      localStorage.setItem("admin-auth", "true");
      unlockAdminUI();
    } else {
      alert("Incorrect password.");
    }
  }

  function unlockAdminUI() {
    document.getElementById("admin-subnav").style.display = "block";
    document.getElementById("login-section").style.display = "none";
  }

  function checkAuth() {
    if (localStorage.getItem("admin-auth") === "true") {
      unlockAdminUI();
    } else {
      document.getElementById("admin-subnav").style.display = "none";
    }
  }


  let allPlayers = [];
  let mainGroup = [];
  let walkOns = [[], [], []];

  function lockWeek() {
    const weekKey = getMondayDate();
    db.ref("state/" + weekKey).update({ locked: true }).then(() => {
      document.getElementById("lock-confirm").innerText = "Submissions locked for the week.";
      checkLockState();
    });
  }

  function loadWeeklyAdminPlayers() {
    const weekKey = getMondayDate();
    db.ref("responses/" + weekKey).once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      allPlayers = Object.entries(data)
        .filter(([_, val]) => val.status === "Yes")
        .sort((a, b) => a[1].timestamp - b[1].timestamp)
        .map(([name]) => name);

      mainGroup = [...allPlayers];
      walkOns = [[], [], []];
      renderGroups();
    });
  }

  function renderGroups() {
    document.getElementById("main-play").innerHTML = mainGroup.map((name, i) =>
      `<div>${name}
        <button onclick="moveToWalkOn(${i}, 0)">‚Üí Walk-On 1</button>
        <button onclick="moveToWalkOn(${i}, 1)">‚Üí Walk-On 2</button>
        <button onclick="moveToWalkOn(${i}, 2)">‚Üí Walk-On 3</button>
      </div>`).join("");

    walkOns.forEach((group, index) => {
      document.getElementById("walkon" + (index + 1)).innerHTML = group.map((name, i) =>
        `<div>${name} <button onclick="moveToMain(${index}, ${i})">‚Üê Back</button></div>`).join("");
    });
  }

  function moveToWalkOn(index, groupIndex) {
    const player = mainGroup.splice(index, 1)[0];
    walkOns[groupIndex].push(player);
    renderGroups();
  }

  function moveToMain(groupIndex, playerIndex) {
    const player = walkOns[groupIndex].splice(playerIndex, 1)[0];
    mainGroup.push(player);
    renderGroups();
  }

</script>

</body>
</html>
